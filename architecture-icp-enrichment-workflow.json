{
  "name": "Architecture Firms: ICP Scoring + Smart Enrichment + Briefs",
  "nodes": [
    {
      "parameters": {
        "operation": "fromFile",
        "filePath": "={{ $json.csvPath }}",
        "options": {
          "delimiter": ","
        }
      },
      "id": "read-csv",
      "name": "Read CSV",
      "type": "n8n-nodes-base.readBinaryFiles",
      "typeVersion": 1,
      "position": [240, 400]
    },
    {
      "parameters": {},
      "id": "csv-to-json",
      "name": "CSV to JSON",
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 2,
      "position": [460, 400]
    },
    {
      "parameters": {
        "batchSize": 10,
        "options": {}
      },
      "id": "split-batches",
      "name": "Split In Batches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [680, 400]
    },
    {
      "parameters": {
        "jsCode": "// PHASE 1: Quick ICP Scoring with Existing Data\n// Scores all firms based on confirmed data to prioritize enrichment\n\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const json = item.json;\n  \n  // Extract and normalize data\n  const companyName = json['Company Name'] || json.company_name || '';\n  const location = json['HQ Location'] || json.location || '';\n  const headcount = json['Headcount'] || json.headcount || '';\n  const revenue = json['Revenue'] || json.revenue || '';\n  const offersCA = json['Offers Construction Admin'] || json.offers_ca || 'Unclear';\n  const caTools = json['CA Management Tools'] || json.ca_tools || 'Research with AI';\n  const litigation = json['Construction Litigation'] || json.litigation || 'None found';\n  const projectTypes = json['Project Focus Types'] || json.project_types || 'Research with AI';\n  const jobTitles = json['Open Job Titles and Dates'] || json.job_titles || '';\n  \n  let score = 0;\n  const scoreBreakdown = {};\n  let needsEnrichment = [];\n  \n  // 1. Construction Admin Offering (30 points)\n  if (offersCA && offersCA.toLowerCase().startsWith('yes')) {\n    // Check if detailed description\n    if (offersCA.length > 20) {\n      score += 30;\n      scoreBreakdown.caOffering = 30;\n    } else {\n      score += 20;\n      scoreBreakdown.caOffering = 20;\n    }\n  } else if (offersCA.toLowerCase().includes('unclear')) {\n    score += 5;\n    scoreBreakdown.caOffering = 5;\n    needsEnrichment.push('ca_offering');\n  } else {\n    scoreBreakdown.caOffering = 0;\n  }\n  \n  // 2. Active CA Job Openings (25 points)\n  const jobLower = jobTitles.toLowerCase();\n  if (jobLower.includes('construction admin') || jobLower.includes('ca supervisor')) {\n    // Multiple or specific CA roles\n    const caCount = (jobLower.match(/construction admin/g) || []).length;\n    if (caCount >= 2) {\n      score += 25;\n      scoreBreakdown.caJobs = 25;\n    } else if (caCount === 1) {\n      score += 15;\n      scoreBreakdown.caJobs = 15;\n    }\n  } else if (jobLower.includes('qa/qc') || jobLower.includes('quality control') || \n             jobLower.includes('bim coordinator') || jobLower.includes('specification writer')) {\n    score += 10;\n    scoreBreakdown.caJobs = 10;\n  } else if (jobLower.includes('yes') && !jobLower.includes('no current')) {\n    score += 5;\n    scoreBreakdown.caJobs = 5;\n  } else {\n    scoreBreakdown.caJobs = 0;\n  }\n  \n  // 3. Headcount Fit (15 points)\n  if (headcount.includes('201-500')) {\n    score += 15;\n    scoreBreakdown.headcount = 15;\n  } else if (headcount.includes('51-200')) {\n    score += 12;\n    scoreBreakdown.headcount = 12;\n  } else if (headcount.includes('11-50')) {\n    score += 5;\n    scoreBreakdown.headcount = 5;\n  } else if (headcount.includes('500')) {\n    score += 3;\n    scoreBreakdown.headcount = 3;\n  } else {\n    scoreBreakdown.headcount = 0;\n  }\n  \n  // 4. Revenue Fit (10 points)\n  if (revenue.includes('$50M-$100M') || revenue.includes('$100M-$250M')) {\n    score += 10;\n    scoreBreakdown.revenue = 10;\n  } else if (revenue.includes('$25M-$50M')) {\n    score += 7;\n    scoreBreakdown.revenue = 7;\n  } else if (revenue.includes('$10M-$25M')) {\n    score += 4;\n    scoreBreakdown.revenue = 4;\n  } else if (revenue.includes('$1M-$10M')) {\n    score += 2;\n    scoreBreakdown.revenue = 2;\n  } else {\n    scoreBreakdown.revenue = 0;\n  }\n  \n  // 5. CA Management Tools (10 points)\n  if (caTools && !caTools.toLowerCase().includes('research')) {\n    const toolLower = caTools.toLowerCase();\n    if (toolLower.includes('procore') || toolLower.includes('plangrid') || \n        toolLower.includes('bim360') || toolLower.includes('fieldwire')) {\n      score += 10;\n      scoreBreakdown.caTools = 10;\n    } else {\n      score += 5;\n      scoreBreakdown.caTools = 5;\n    }\n  } else {\n    scoreBreakdown.caTools = 0;\n    needsEnrichment.push('ca_tools');\n  }\n  \n  // 6. Project Focus Types (10 points)\n  if (projectTypes && !projectTypes.toLowerCase().includes('research')) {\n    const typesLower = projectTypes.toLowerCase();\n    let verticalScore = 0;\n    \n    if (typesLower.includes('healthcare')) verticalScore += 4;\n    if (typesLower.includes('data center')) verticalScore += 4;\n    if (typesLower.includes('commercial')) verticalScore += 3;\n    if (typesLower.includes('education')) verticalScore += 3;\n    if (typesLower.includes('government') || typesLower.includes('civic')) verticalScore += 2;\n    if (typesLower.includes('multi-family')) verticalScore += 2;\n    \n    verticalScore = Math.min(verticalScore, 10);\n    score += verticalScore;\n    scoreBreakdown.verticals = verticalScore;\n  } else {\n    scoreBreakdown.verticals = 0;\n    needsEnrichment.push('project_types');\n  }\n  \n  // 7. Construction Litigation (varies, -15 to 0)\n  if (litigation && !litigation.toLowerCase().includes('none')) {\n    const litLower = litigation.toLowerCase();\n    if (litLower.includes('multiple') || litLower.includes('defect')) {\n      score -= 15;\n      scoreBreakdown.litigation = -15;\n    } else if (litLower.includes('dispute') || litLower.includes('yes')) {\n      score -= 5;\n      scoreBreakdown.litigation = -5;\n    }\n  } else {\n    scoreBreakdown.litigation = 0;\n  }\n  \n  // 8. Geographic Fit (5 points)\n  const locationLower = location.toLowerCase();\n  if (locationLower.includes('new york') || locationLower.includes('san francisco') || \n      locationLower.includes('los angeles') || locationLower.includes('chicago') || \n      locationLower.includes('boston') || locationLower.includes('seattle')) {\n    score += 5;\n    scoreBreakdown.geography = 5;\n  } else if (locationLower.includes('united states')) {\n    score += 3;\n    scoreBreakdown.geography = 3;\n  } else if (locationLower.includes('canada')) {\n    score += 2;\n    scoreBreakdown.geography = 2;\n  } else {\n    scoreBreakdown.geography = 0;\n  }\n  \n  // Determine priority tier\n  let priority = 'P4';\n  let enrichmentTier = 'none';\n  \n  if (score >= 75) {\n    priority = 'P1';\n    enrichmentTier = 'deep'; // Full enrichment + brief\n  } else if (score >= 55) {\n    priority = 'P2';\n    enrichmentTier = 'medium'; // Enrichment, no brief\n  } else if (score >= 35) {\n    priority = 'P3';\n    enrichmentTier = 'light'; // Minimal enrichment\n  } else {\n    priority = 'P4';\n    enrichmentTier = 'none'; // No enrichment\n  }\n  \n  results.push({\n    json: {\n      companyName,\n      location,\n      headcount,\n      revenue,\n      offersCA,\n      caTools,\n      litigation,\n      projectTypes,\n      jobTitles,\n      \n      // Scoring results\n      initialScore: score,\n      scoreBreakdown,\n      priority,\n      enrichmentTier,\n      needsEnrichment,\n      \n      // Raw data for enrichment\n      rawData: json\n    }\n  });\n}\n\nreturn results;"
        },
        "options": {}
      },
      "id": "quick-icp-score",
      "name": "Quick ICP Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "deep-enrichment",
              "leftValue": "={{ $json.enrichmentTier }}",
              "rightValue": "deep",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "medium-enrichment",
              "leftValue": "={{ $json.enrichmentTier }}",
              "rightValue": "medium",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "light-enrichment",
              "leftValue": "={{ $json.enrichmentTier }}",
              "rightValue": "light",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "enrichment-router",
      "name": "Enrichment Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1120, 400]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "message",
        "model": "gpt-4o-mini",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are an expert researcher analyzing architecture firms. Extract specific information accurately and cite sources."
            },
            {
              "role": "user",
              "content": "=Company: {{ $json.companyName }}\n\nCurrent Data:\n- Offers CA: {{ $json.offersCA }}\n- CA Tools: {{ $json.caTools }}\n- Project Types: {{ $json.projectTypes }}\n\nFields marked \"Research with AI\" or \"Unclear\" need confirmation.\n\nTask: Research this firm and fill in missing data:\n\n1. **Confirm CA Offering**: Do they explicitly offer Construction Administration services?\n2. **CA Tools**: What project management/CA tools do they use? (Look for: Procore, PlanGrid, BIM360, Fieldwire, Bluebeam, etc.)\n3. **Project Verticals**: What are their primary project types? Calculate % if possible.\n4. **Technology Stack**: What BIM/design tools? (Revit, ArchiCAD, Rhino, etc.)\n5. **Recent CA Job Postings**: Any Construction Admin roles posted in last 6 months?\n\nReturn JSON:\n{\n  \"ca_offering\": {\n    \"confirmed\": true/false,\n    \"description\": \"string\",\n    \"evidence\": [\"quote or URL\"],\n    \"confidence\": 0.0-1.0\n  },\n  \"ca_tools\": {\n    \"tools\": [\"tool1\", \"tool2\"],\n    \"evidence\": [\"source\"],\n    \"confidence\": 0.0-1.0\n  },\n  \"project_verticals\": [\n    {\"type\": \"Healthcare\", \"percentage\": 25, \"evidence\": \"...\"}\n  ],\n  \"tech_stack\": {\n    \"bim_tools\": [\"Revit\", \"...\"],\n    \"other_tools\": [\"Bluebeam\", \"...\"]\n  },\n  \"recent_ca_jobs\": [\n    {\"title\": \"Construction Administrator\", \"posted\": \"Jan 2026\"}\n  ]\n}"
            }
          ]
        },
        "options": {
          "temperature": 0.3,
          "response_format": "json_object"
        }
      },
      "id": "ai-light-research",
      "name": "AI: Light Research (P3)",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [1340, 200],
      "credentials": {
        "openAiApi": {
          "id": "openai-credentials",
          "name": "OpenAI"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://r.jina.ai/{{ $json.rawData.domain || $json.companyName.toLowerCase().replace(/\\s+/g, '') + '.com' }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "timeout": 30000
        }
      },
      "id": "scrape-website",
      "name": "Scrape Website",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1340, 400]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "message",
        "model": "gpt-4o-mini",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are an expert at analyzing architecture firm websites and extracting business intelligence."
            },
            {
              "role": "user",
              "content": "=Company: {{ $json.companyName }}\nWebsite Content:\n{{ $json.data }}\n\nAnalyze this website deeply:\n\n1. **CA Services**: Confirm if they offer Construction Administration. Look for service pages, project descriptions, team bios.\n2. **CA Tools**: Identify any software/tools mentioned (Procore, PlanGrid, BIM360, Revit, Bluebeam, etc.)\n3. **Project Portfolio**: Extract project types and calculate approximate breakdown.\n4. **Team Capabilities**: Look for CA-related roles, BIM expertise, technical capabilities.\n5. **Pain Points**: Any mentions of challenges, outdated processes, or areas for improvement?\n6. **Digital Maturity**: Are they tech-forward? Mention of digital twins, AI, BIM Level 2+?\n\nReturn JSON:\n{\n  \"ca_offering\": {\n    \"confirmed\": true/false,\n    \"description\": \"detailed description\",\n    \"evidence\": [\"quotes from website\"],\n    \"confidence\": 0.0-1.0\n  },\n  \"ca_tools\": {\n    \"confirmed_tools\": [\"Procore\", \"...\"],\n    \"likely_tools\": [\"tool name\"],\n    \"evidence\": [\"where mentioned\"]\n  },\n  \"project_analysis\": {\n    \"verticals\": [\n      {\"type\": \"Healthcare\", \"percentage\": 30, \"evidence\": \"3 hospital projects listed\"},\n      {\"type\": \"Commercial\", \"percentage\": 40, \"evidence\": \"...\"}\n    ],\n    \"notable_projects\": [\n      {\"name\": \"Project Name\", \"type\": \"Healthcare\", \"size\": \"$50M\", \"ca_mentioned\": true}\n    ]\n  },\n  \"team_capabilities\": {\n    \"has_ca_team\": true/false,\n    \"bim_maturity\": \"low|medium|high\",\n    \"technical_staff_count\": \"estimate\",\n    \"evidence\": [\"team page mentions...\"]\n  },\n  \"pain_points\": [\n    \"coordination challenges mentioned\",\n    \"manual processes described\"\n  ],\n  \"digital_maturity\": {\n    \"level\": \"low|medium|high\",\n    \"signals\": [\"BIM 360 adoption\", \"digital twin projects\"],\n    \"evidence\": [\"...\"]\n  }\n}"
            }
          ]
        },
        "options": {
          "temperature": 0.3,
          "response_format": "json_object"
        }
      },
      "id": "ai-medium-analysis",
      "name": "AI: Medium Analysis (P2)",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [1560, 400],
      "credentials": {
        "openAiApi": {
          "id": "openai-credentials",
          "name": "OpenAI"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.apollo.io/v1/mixed_people/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"q_organization_name\": \"{{ $json.companyName }}\",\n  \"person_titles\": [\n    \"Principal\",\n    \"Partner\",\n    \"Director of Operations\",\n    \"CTO\",\n    \"Chief Technology Officer\",\n    \"Construction Administrator\",\n    \"CA Manager\",\n    \"BIM Manager\",\n    \"Director of Construction\",\n    \"VP of Operations\"\n  ],\n  \"per_page\": 10\n}",
        "options": {}
      },
      "id": "apollo-contacts",
      "name": "Apollo: Find Contacts (P1)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1340, 600],
      "credentials": {
        "httpHeaderAuth": {
          "id": "apollo-credentials",
          "name": "Apollo API"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "contacts-array",
              "name": "contacts",
              "value": "={{ $json.people || [] }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "id": "extract-contacts",
      "name": "Extract Contacts",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [1560, 600]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "message",
        "model": "gpt-4o-mini",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are an expert at analyzing professional profiles to identify decision-makers and assess fit for construction technology solutions."
            },
            {
              "role": "user",
              "content": "=Company: {{ $json.companyName }}\n\nContacts Found:\n{{ JSON.stringify($json.contacts, null, 2) }}\n\nAnalyze each contact:\n\n1. **Decision Authority**: Likelihood they influence tech/CA tool purchases (0-100)\n2. **CA Involvement**: How involved in construction administration? (0-100)\n3. **Tech Adoption**: Likelihood to champion new technology (0-100)\n4. **Pain Points**: What challenges do they likely face based on role?\n5. **Outreach Strategy**: Best approach (email, LinkedIn, phone)\n6. **Personalized Angle**: One-sentence hook specific to their role\n\nReturn JSON:\n{\n  \"contact_analysis\": [\n    {\n      \"name\": \"John Doe\",\n      \"title\": \"Director of Operations\",\n      \"email\": \"john@...\",\n      \"decision_authority\": 85,\n      \"ca_involvement\": 90,\n      \"tech_adoption\": 70,\n      \"pain_points\": [\n        \"Coordinating multiple projects\",\n        \"RFI bottlenecks\",\n        \"Submittal tracking\"\n      ],\n      \"recommended_outreach\": \"email\",\n      \"personalized_angle\": \"Help your team reduce RFI response time from 5 days to 24 hours\",\n      \"priority_rank\": 1\n    }\n  ],\n  \"overall_contact_score\": 75,\n  \"best_contact\": \"John Doe - Director of Operations\",\n  \"outreach_readiness\": \"high|medium|low\"\n}"
            }
          ]
        },
        "options": {
          "temperature": 0.4,
          "response_format": "json_object"
        }
      },
      "id": "ai-contact-analysis",
      "name": "AI: Contact Analysis (P1)",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [1780, 600],
      "credentials": {
        "openAiApi": {
          "id": "openai-credentials",
          "name": "OpenAI"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// PHASE 2: Re-score after enrichment\n// Recalculates ICP score with enriched data\n\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const json = item.json;\n  \n  let finalScore = json.initialScore || 0;\n  const enrichedData = {};\n  \n  // Parse enrichment results based on tier\n  if (json.enrichmentTier === 'light') {\n    // Light enrichment (AI research)\n    const research = JSON.parse(json.message?.content || '{}');\n    enrichedData.caOffering = research.ca_offering;\n    enrichedData.caTools = research.ca_tools;\n    enrichedData.projectVerticals = research.project_verticals;\n    enrichedData.techStack = research.tech_stack;\n    \n    // Adjust score based on new data\n    if (research.ca_offering?.confirmed && research.ca_offering.confidence > 0.7) {\n      finalScore += 15; // Bonus for confirming CA\n    }\n    if (research.ca_tools?.tools?.length > 0) {\n      finalScore += 8;\n    }\n    if (research.project_verticals?.length > 0) {\n      const hasTargetVerticals = research.project_verticals.some(v => \n        ['Healthcare', 'Data Center', 'Commercial'].includes(v.type)\n      );\n      if (hasTargetVerticals) finalScore += 8;\n    }\n    \n  } else if (json.enrichmentTier === 'medium') {\n    // Medium enrichment (website scrape + analysis)\n    const analysis = JSON.parse(json.message?.content || '{}');\n    enrichedData.caOffering = analysis.ca_offering;\n    enrichedData.caTools = analysis.ca_tools;\n    enrichedData.projectAnalysis = analysis.project_analysis;\n    enrichedData.teamCapabilities = analysis.team_capabilities;\n    enrichedData.painPoints = analysis.pain_points;\n    enrichedData.digitalMaturity = analysis.digital_maturity;\n    \n    // Adjust score\n    if (analysis.ca_offering?.confirmed && analysis.ca_offering.confidence > 0.8) {\n      finalScore += 20;\n    }\n    if (analysis.ca_tools?.confirmed_tools?.length > 0) {\n      finalScore += 10;\n    }\n    if (analysis.digital_maturity?.level === 'high') {\n      finalScore += 10;\n    }\n    if (analysis.pain_points?.length > 0) {\n      finalScore += 5; // Pain points = opportunity\n    }\n    \n  } else if (json.enrichmentTier === 'deep') {\n    // Deep enrichment (website + contacts)\n    const contactAnalysis = JSON.parse(json.message?.content || '{}');\n    enrichedData.contacts = contactAnalysis.contact_analysis;\n    enrichedData.overallContactScore = contactAnalysis.overall_contact_score;\n    enrichedData.bestContact = contactAnalysis.best_contact;\n    enrichedData.outreachReadiness = contactAnalysis.outreach_readiness;\n    \n    // Also include medium enrichment data\n    enrichedData.caOffering = json.ca_offering;\n    enrichedData.caTools = json.ca_tools;\n    enrichedData.projectAnalysis = json.project_analysis;\n    enrichedData.painPoints = json.pain_points;\n    \n    // Adjust score based on contacts\n    const avgDecisionAuthority = contactAnalysis.contact_analysis?.reduce(\n      (sum, c) => sum + (c.decision_authority || 0), 0\n    ) / (contactAnalysis.contact_analysis?.length || 1);\n    \n    if (avgDecisionAuthority >= 70) {\n      finalScore += 15;\n    } else if (avgDecisionAuthority >= 50) {\n      finalScore += 10;\n    }\n    \n    if (contactAnalysis.outreach_readiness === 'high') {\n      finalScore += 10;\n    }\n  }\n  \n  // Recalculate priority based on final score\n  let finalPriority = 'P4';\n  if (finalScore >= 80) finalPriority = 'P1';\n  else if (finalScore >= 65) finalPriority = 'P2';\n  else if (finalScore >= 50) finalPriority = 'P3';\n  \n  results.push({\n    json: {\n      ...json,\n      finalScore,\n      finalPriority,\n      enrichedData,\n      enrichmentComplete: true\n    }\n  });\n}\n\nreturn results;"
        },
        "options": {}
      },
      "id": "rescore-after-enrichment",
      "name": "Re-score After Enrichment",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2000, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "p1-brief",
              "leftValue": "={{ $json.finalPriority }}",
              "rightValue": "P1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "brief-filter",
      "name": "Filter for Brief (P1 Only)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [2220, 400]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "message",
        "model": "gpt-4o",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are an expert B2B sales strategist specializing in construction technology for architecture firms. Create compelling, data-driven outreach briefs that convert."
            },
            {
              "role": "user",
              "content": "=# Outreach Brief Generation\n\n## Company Profile\n**Name**: {{ $json.companyName }}\n**Location**: {{ $json.location }}\n**Size**: {{ $json.headcount }} employees, {{ $json.revenue }} revenue\n**Priority**: {{ $json.finalPriority }} (Score: {{ $json.finalScore }}/105)\n\n## Intelligence Gathered\n\n### Construction Administration\n{{ JSON.stringify($json.enrichedData.caOffering, null, 2) }}\n\n### Technology Stack\n{{ JSON.stringify($json.enrichedData.caTools, null, 2) }}\n\n### Project Portfolio\n{{ JSON.stringify($json.enrichedData.projectAnalysis, null, 2) }}\n\n### Pain Points Identified\n{{ JSON.stringify($json.enrichedData.painPoints, null, 2) }}\n\n### Key Contacts\n{{ JSON.stringify($json.enrichedData.contacts, null, 2) }}\n\n---\n\n## Your Task\n\nCreate a comprehensive outreach brief with:\n\n## 1. Executive Summary (2-3 sentences)\nWhy is this firm a high-priority target? What's the core opportunity?\n\n## 2. ICP Fit Analysis\n‚úÖ **Strengths**:\n- List 3-5 reasons they match ICP\n\n‚ö†Ô∏è **Considerations**:\n- Any risks or challenges\n\n## 3. Technology & Process Assessment\n**Current State**:\n- CA tools in use\n- Process maturity\n- Pain points\n\n**Opportunity**:\n- Where can we add value?\n- Specific improvements possible\n\n## 4. Contact Strategy\n\n### Primary Contact\n**Name**: [from contacts]\n**Title**: [title]\n**Why Them**: [decision authority + CA involvement]\n**Pain Points**: [specific to their role]\n\n### Outreach Sequence\n\n**Touch 1 - Email (Day 1)**\nSubject: [compelling subject line]\nHook: [personalized opening]\nValue prop: [specific to their pain points]\nCTA: [clear next step]\n\n**Touch 2 - LinkedIn (Day 3)**\nConnection note: [brief, value-focused]\n\n**Touch 3 - Email (Day 7)**\nFollow-up angle: [different value angle]\n\n### Talking Points\n1. **Pain Point #1**: [their challenge] ‚Üí [our solution]\n2. **Pain Point #2**: [their challenge] ‚Üí [our solution]\n3. **ROI Angle**: [quantify potential impact]\n\n## 5. Competitive Context\nWhat tools are they likely using? How do we differentiate?\n\n## 6. Case Study Match\nWhich of our case studies would resonate? (similar size, vertical, challenge)\n\n## 7. Warm Intro Paths\nAny potential warm intro opportunities? (check LinkedIn connections, shared clients, etc.)\n\n## 8. Next Actions (Prioritized)\n- [ ] Action 1\n- [ ] Action 2\n- [ ] Action 3\n\n## 9. Key Risks/Objections\nWhat might block this deal? How do we preempt?\n\n## 10. Supporting Evidence\nQuotes, URLs, and data points to reference in outreach.\n\n---\n\n**Make it specific, actionable, and ready to execute.**"
            }
          ]
        },
        "options": {
          "temperature": 0.7
        }
      },
      "id": "generate-brief",
      "name": "Generate Outreach Brief (GPT-4o)",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [2440, 400],
      "credentials": {
        "openAiApi": {
          "id": "openai-credentials",
          "name": "OpenAI"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "schema": "public",
        "table": "enriched_architecture_firms",
        "columns": {
          "mappings": [
            {
              "column": "company_name",
              "value": "={{ $json.companyName }}"
            },
            {
              "column": "location",
              "value": "={{ $json.location }}"
            },
            {
              "column": "headcount",
              "value": "={{ $json.headcount }}"
            },
            {
              "column": "revenue",
              "value": "={{ $json.revenue }}"
            },
            {
              "column": "initial_score",
              "value": "={{ $json.initialScore }}"
            },
            {
              "column": "final_score",
              "value": "={{ $json.finalScore }}"
            },
            {
              "column": "priority",
              "value": "={{ $json.finalPriority }}"
            },
            {
              "column": "enrichment_tier",
              "value": "={{ $json.enrichmentTier }}"
            },
            {
              "column": "enriched_data",
              "value": "={{ JSON.stringify($json.enrichedData) }}"
            },
            {
              "column": "brief",
              "value": "={{ $json.brief || null }}"
            },
            {
              "column": "processed_at",
              "value": "={{ $now }}"
            }
          ]
        },
        "options": {}
      },
      "id": "save-to-db",
      "name": "Save to PostgreSQL",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [2660, 400],
      "credentials": {
        "postgres": {
          "id": "postgres-credentials",
          "name": "PostgreSQL"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": "={{ $env.GOOGLE_SHEET_ID }}",
        "sheetName": "ICP Priority List",
        "columns": {
          "mappings": [
            {
              "column": "Company Name",
              "value": "={{ $json.companyName }}"
            },
            {
              "column": "Location",
              "value": "={{ $json.location }}"
            },
            {
              "column": "Headcount",
              "value": "={{ $json.headcount }}"
            },
            {
              "column": "Revenue",
              "value": "={{ $json.revenue }}"
            },
            {
              "column": "Initial Score",
              "value": "={{ $json.initialScore }}"
            },
            {
              "column": "Final Score",
              "value": "={{ $json.finalScore }}"
            },
            {
              "column": "Priority",
              "value": "={{ $json.finalPriority }}"
            },
            {
              "column": "Enrichment Tier",
              "value": "={{ $json.enrichmentTier }}"
            },
            {
              "column": "CA Confirmed",
              "value": "={{ $json.enrichedData.caOffering?.confirmed || 'Unknown' }}"
            },
            {
              "column": "CA Tools",
              "value": "={{ $json.enrichedData.caTools?.confirmed_tools?.join(', ') || 'Unknown' }}"
            },
            {
              "column": "Best Contact",
              "value": "={{ $json.enrichedData.bestContact || 'N/A' }}"
            },
            {
              "column": "Brief Generated",
              "value": "={{ $json.brief ? 'Yes' : 'No' }}"
            },
            {
              "column": "Processed Date",
              "value": "={{ $now.toFormat('yyyy-MM-dd HH:mm') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "export-to-sheets",
      "name": "Export to Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [2660, 600],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credentials",
          "name": "Google Sheets OAuth2"
        }
      }
    },
    {
      "parameters": {
        "content": "=üéØ **ICP Enrichment Progress Update**\n\n**Batch Complete**: {{ $json.companyName }}\n**Priority**: {{ $json.finalPriority }} (Score: {{ $json.finalScore }})\n**Enrichment**: {{ $json.enrichmentTier }}\n\n{{ $json.finalPriority === 'P1' ? 'üî• **P1 PRIORITY - Brief Generated**' : '' }}\n\n**Summary**:\n{{ $json.finalPriority === 'P1' || $json.finalPriority === 'P2' ? '‚úÖ High-value prospect enriched' : 'üìä Scored and saved to database' }}",
        "channel": "={{ $env.SLACK_CHANNEL || '#sales-leads' }}",
        "options": {}
      },
      "id": "slack-notification",
      "name": "Slack Notification (Optional)",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [2880, 500],
      "credentials": {
        "slackApi": {
          "id": "slack-credentials",
          "name": "Slack"
        }
      }
    }
  ],
  "connections": {
    "Read CSV": {
      "main": [
        [
          {
            "node": "CSV to JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CSV to JSON": {
      "main": [
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split In Batches": {
      "main": [
        [
          {
            "node": "Quick ICP Score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Quick ICP Score": {
      "main": [
        [
          {
            "node": "Enrichment Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enrichment Router": {
      "main": [
        [
          {
            "node": "Apollo: Find Contacts (P1)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Scrape Website",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Scrape Website",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI: Light Research (P3)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Re-score After Enrichment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: Light Research (P3)": {
      "main": [
        [
          {
            "node": "Re-score After Enrichment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrape Website": {
      "main": [
        [
          {
            "node": "AI: Medium Analysis (P2)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: Medium Analysis (P2)": {
      "main": [
        [
          {
            "node": "Re-score After Enrichment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apollo: Find Contacts (P1)": {
      "main": [
        [
          {
            "node": "Extract Contacts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Contacts": {
      "main": [
        [
          {
            "node": "AI: Contact Analysis (P1)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: Contact Analysis (P1)": {
      "main": [
        [
          {
            "node": "Re-score After Enrichment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Re-score After Enrichment": {
      "main": [
        [
          {
            "node": "Filter for Brief (P1 Only)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter for Brief (P1 Only)": {
      "main": [
        [
          {
            "node": "Generate Outreach Brief (GPT-4o)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Save to PostgreSQL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Outreach Brief (GPT-4o)": {
      "main": [
        [
          {
            "node": "Save to PostgreSQL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save to PostgreSQL": {
      "main": [
        [
          {
            "node": "Export to Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Export to Google Sheets": {
      "main": [
        [
          {
            "node": "Slack Notification (Optional)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "icp-scoring",
      "id": "1"
    },
    {
      "name": "smart-enrichment",
      "id": "2"
    },
    {
      "name": "architecture-firms",
      "id": "3"
    }
  ],
  "meta": {
    "instanceId": "architecture-icp-enrichment-001"
  },
  "pinData": {},
  "versionId": "2.0.0",
  "triggerCount": 0,
  "active": false
}
